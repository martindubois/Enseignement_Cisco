
! Auteur   Martin Dubois, ing.
! Produit  Enseignement/Cisco
! Fichier  ExempleComplet/Routeur0.txt

enable
    configure terminal

        ! Access list
        no ip access-list extended 100
        no ip access-list extended 110
        no ip access-list extended 120
        ip access-list extended 100
            ! En in sur l'interface externe - Il ne faut pas utiliser les adresses privees dans cette liste.
            ! Reponse DNS vers le serveur DNS.
            permit udp host 8.8.8.8 eq 53 any
            ! Reponse TCP vers les ordinateurs qui visitent Internet
            permit tcp any any established
        ip access-list extended 110
            ! En out sur l'interface connecte au sous-reseau des serveurs
            permit tcp 192.168.20.0 0.0.0.255 host 192.168.10.10 eq 25
            permit tcp 192.168.20.0 0.0.0.255 host 192.168.10.10 eq 80
            permit tcp 192.168.20.0 0.0.0.255 host 192.168.10.10 eq 110
            permit tcp 192.168.20.0 0.0.0.255 host 192.168.10.20 eq 80
            permit tcp 192.168.21.0 0.0.0.255 host 192.168.10.10 eq 25
            permit tcp 192.168.21.0 0.0.0.255 host 192.168.10.10 eq 80
            permit tcp 192.168.21.0 0.0.0.255 host 192.168.10.10 eq 110
            permit tcp 192.168.21.0 0.0.0.255 host 192.168.10.20 eq 80
            permit tcp 192.168.30.0 0.0.0.255 host 192.168.10.10 eq 25
            permit tcp 192.168.30.0 0.0.0.255 host 192.168.10.10 eq 80
            permit tcp 192.168.30.0 0.0.0.255 host 192.168.10.10 eq 110
            permit udp 192.168.20.0 0.0.0.255 host 192.168.10.10 eq 53
            permit udp 192.168.21.0 0.0.0.255 host 192.168.10.10 eq 53
            permit udp 192.168.30.0 0.0.0.255 host 192.168.10.10 eq 53
            permit udp host 8.8.8.8 eq 53 host 192.168.10.10
        ip access-list extended 120
            ! En out sur l'interface connecte au sous-reseau des administrateurs
        exit

        interface f0/0
            no shutdown
            ip address 8.0.0.1 255.0.0.0
            ip nat outside
        interface f0/1
            no shutdown
        interface f0/1.1
            no shutdown
            encapsulation dot1q 10
            ip address 192.168.10.1
        interface f0/1.2
            no shutdown
            encapsulation dot1q 20
            ip address 192.168.20.1
            ip nat inside
        interface tunel 0
            ip address 192.168.40.1
            tunnel destination 8.1.0.1
            tunnel source f0/0
            tunnel mode gre ip
        exit

        ! DHCP
        no ip dhcp pool Admins
        ip dhcp pool Admins
            no default-router
            no dns-server
            default router 192.168.20.1
            dns-server 192.168.10.10
            network 192.168.20.0 255.255.255.0
        exit
        ip dhcp excluded-address 192.168.20.1

        ! NAT
        no access-list 1
        access-list 1 permit 192.168.20.0 0.0.0.255
        ip nat pool NAT 8.0.0.1 8.0.0.1 netmask 255.0.0.0
        ip nat inside source list 1 pool NAT overload

        ! Routes
        ip route 192.168.21.0 255.255.255.0 192.168.40.2
        ip route 192.168.30.0 255.255.255.0 192.168.40.2

        ip routing
    exit
exit
